@page "/request/{Id:guid}"

@using Entities.Models;
@if(_request != null)
{   

<MudGrid>
    <MudPaper  MinWidth=500px Elevation=0 Class="d-flex flex-column align-center justify-center gap-4 mud-width-full grey lighten-5 mb-4" >
            
             <MudPaper 
                Elevation=0 MinWidth=500px MaxWidth=45%
                 Class="d-flex mud-width-full justify-start mt-10 flex-column gap-4"
                  Style="@($"border:1px solid {Colors.BlueGrey.Lighten5};")">
                <MudPaper Elevation=0 Class="d-flex  mud-width-full justify-space-between align-center">
                    <MudText Class="d-flex  ml-4 " Typo="Typo.h5">Данные заявки</MudText>
                    <MudPaper Elevation=0 Class="d-flex mt-6 gap-4 mr-4">
                        <MudButton 
                            OnClick="@Update" 
                            Variant="Variant.Outlined" 
                            Color="Color.Primary">Сохранить
                        </MudButton>
                        <MudButton 
                            OnClick="@GenerateRequest" 
                            EndIcon="@Icons.Material.Filled.Send" 
                            Variant="Variant.Filled" 
                            Color="Color.Primary">Отправить
                        </MudButton> 
                    </MudPaper>
                    
                </MudPaper>
                <MudPaper Elevation=0 Class="d-flex  mud-width-full justify-space-between align-center">
                    <MudText Class="d-flex pl-4  " >Организация: @_request.ShortName</MudText>  
                </MudPaper>
                <MudPaper Elevation=0 Class="d-flex  mud-width-full justify-space-between align-center">
                    <MudText Class="d-flex pl-4 " >ИНН: @_request.Inn</MudText>
                </MudPaper>
                <MudPaper Elevation=0 Class="d-flex  mud-width-full justify-space-between align-center">
                    <MudText Class="d-flex pl-4  mb-4 " >Криптопровайдер: @providerRuName</MudText>
                </MudPaper>
            </MudPaper>
            <MudPaper 
                Elevation=0 MinWidth=500px MaxWidth=45%
                 Class="d-flex mud-width-full justify-center "
                  Style="@($"border:1px solid {Colors.BlueGrey.Lighten5};")">
                <MudCardContent Class="mud-width-full">
                    <MudText>Данные владельца ЭП</MudText>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex align-stretch gap-4" >
                            <MudTextField 
                                RequiredError="Поле на заполнено" Required=true
                                @bind-Value="_request.PersonLastName"  
                                Label="Фамилия" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal" >
                            </MudTextField>
                            <MudTextField 
                                RequiredError="Поле на заполнено" Required=true 
                                @bind-Value="_request.PersonFirstName" 
                                Label="Имя" Variant="Variant.Outlined" 
                                Margin="Margin.Normal">
                            </MudTextField>
                            <MudTextField 
                                @bind-Value="_request.PersonPatronymic" 
                                Label="Отчество" Variant="Variant.Outlined" 
                                Margin="Margin.Normal">
                            </MudTextField>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex justify-space-between gap-4" >
                            <MudPaper MaxWidth=45% Class="d-flex mud-width-full" >
                                <MudAutocomplete 
                                    Variant="Variant.Outlined"
                                    RequiredError="Поле на заполнено" Required=true
                                    T="Country" 
                                    Label="Гражданство"
                                    Clearable=true 
                                    Value="CyrrentCountry" 
                                    ValueChanged="@CountryChanged"
                                    SearchFunc="@SearchCountry" 
                                    ToStringFunc="@(state => state.CountryName)">
                                </MudAutocomplete>
                            </MudPaper>
                            
                            <MudPaper MaxWidth=50% Elevation=0  Class="d-flex align-center ">
                                <MudText Class="pr-4">Пол:</MudText>
                                <MudForm Class="d-flex align-center">
                                    <MudRadioGroup 
                                        @bind-SelectedOption="_request.PersonGender"
                                        Class="d-flex" 
                                        T="int?"
                                        Required=true
                                        RequiredError="Укажите пол"
                                        >
                                        <MudRadio T="int?" Option="@(1)" Color="Color.Primary">Муж</MudRadio>
                                        <MudRadio T="int?" Option="@(2)" Color="Color.Primary">Жен</MudRadio>
                                    </MudRadioGroup>
                                </MudForm>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex align-start gap-4" >
                            <MudTextField 
                                RequiredError="Поле на заполнено" Required=true
                                @bind-Value="_request.PersonPassportSeries"  
                                Label="Серия" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal"
                                 >
                            </MudTextField>
                            <MudTextField 
                                RequiredError="Поле на заполнено" Required=true 
                                @bind-Value="_request.PersonPassportNumber" 
                                Label="Номер" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal">
                            </MudTextField>
                            <MudDatePicker Class="d-flex mt-2" Style="margin-top:2px"
                                Variant="Variant.Outlined" 
                                Label="Дата выдачи" 
                                Editable="true" 
                                Date="PassportDate" 
                                DateChanged="PassportDateChanged"
                                Mask="@(new DateMask("dd.MM.yyyy"))" 
                                DateFormat="dd.MM.yyyy"
                                 />
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex align-stretch gap-4" >
                            <MudPaper Elevation=0 Class="d-flex mud-width-full">
                                <MudTextField  
                                RequiredError="Поле на заполнено" Required=true
                                @bind-Value="_request.PersonPassportAddon"  
                                Label="Кем выдан" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal" >
                            </MudTextField>
                            </MudPaper>
                            <MudPaper Elevation=0 MaxWidth=35% MinWidth=200px Class="d-flex mud-width-full">
                                <MudTextField 
                                    @bind-Value="_request.PersonPassportUnit" 
                                    RequiredError="Поле на заполнено" Required=true
                                    Label="Код подразделения" 
                                    Variant="Variant.Outlined" 
                                    Margin="Margin.Normal"
                                    Mask="@(new PatternMask("000-000"))" >
                                </MudTextField>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex align-stretch gap-4" >
                            <MudPaper Elevation=0 Class="d-flex mud-width-full">
                                <MudTextField  
                                RequiredError="Поле на заполнено" Required=true
                                @bind-Value="_request.PersonBirthPlace"  
                                Label="Место рождения" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal" >
                            </MudTextField>
                            </MudPaper>
                            <MudPaper Elevation=0 MaxWidth=35% MinWidth=200px Class="d-flex mud-width-full">
                                <MudDatePicker Class="d-flex mt-2" Style="margin-top:2px"
                                    Variant="Variant.Outlined" 
                                    Label="Дата рождения" 
                                    Editable="true" 
                                    Date="BirthDate" 
                                    DateChanged="BirthDateChanged"
                                    Mask="@(new DateMask("dd.MM.yyyy"))" 
                                    DateFormat="dd.MM.yyyy"
                                    />
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex align-stretch gap-4" >
                            <MudPaper Elevation=0 Class="d-flex mud-width-full">
                                <MudTextField  
                                RequiredError="Поле на заполнено" Required=true
                                @bind-Value="_request.PersonInn"  
                                Label="ИНН ФЛ" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal" >
                            </MudTextField>
                            </MudPaper>
                            <MudPaper Elevation=0  Class="d-flex mud-width-full">
                                <MudTextField 
                                    @bind-Value="_request.PersonSnils" 
                                    RequiredError="Поле на заполнено" Required=true
                                    Label="СНИЛС" 
                                    Variant="Variant.Outlined" 
                                    Margin="Margin.Normal"
                                    Mask="@(new PatternMask("000-000-000 00"))" >
                                </MudTextField>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex align-stretch gap-4" >
                            <MudPaper Elevation=0 Class="d-flex mud-width-full">
                                <MudTextField  
                                RequiredError="Поле на заполнено" Required=true
                                @bind-Value="_request.PersonEmail"  
                                Label="Email" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal" >
                            </MudTextField>
                            </MudPaper>
                            <MudPaper Elevation=0  Class="d-flex mud-width-full">
                                <MudTextField 
                                    @bind-Value="_request.Phone" 
                                    RequiredError="Поле на заполнено" Required=true
                                    Label="Мобильный Телефон" 
                                    Variant="Variant.Outlined" 
                                    Margin="Margin.Normal"
                                    Mask="@(new PatternMask("0 (000) 000-00-00"))" >
                                </MudTextField>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                    @if (_request.IsJuridical)
                    {
                        <MudGrid>
                        <MudItem xs="12" Class="d-flex align-stretch gap-4" >
                            <MudPaper Elevation=0 Class="d-flex mud-width-full">
                                <MudTextField  
                                RequiredError="Поле на заполнено" Required=true
                                @bind-Value="_request.PersonPost"  
                                Label="Должность" 
                                Variant="Variant.Outlined" 
                                Margin="Margin.Normal" >
                            </MudTextField>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                    }
                </MudCardContent>
            </MudPaper>
            <MudPaper 
                Elevation=0 MinWidth=500px MaxWidth=45%
                 Class="d-flex mud-width-full justify-center "
                  Style="@($"border:1px solid {Colors.BlueGrey.Lighten5};")">
                <MudCardContent Class="mud-width-full">
                    <MudText>Требуемые документы</MudText>
                    <MudText 
                        Class="pt-3"  
                        Style="@($"color:{Colors.BlueGrey.Lighten3};")" 
                        Typo="Typo.body2">
                        Загрузите цветные сканы или фото оригиналов документов
                    </MudText>
                    <MudGrid>
                        <MudItem xs="12" Class="d-flex align-start justify-space-between  gap-4 mt-4" >
                            <MudPaper Elevation=0 Width=48% Class="d-flex flex-column">
                                <MudPaper Elevation=0 Class="d-flex">
                                    <MudText>Паспорт</MudText>
                                    
                                </MudPaper>
                                <MudPaper Elevation=0 Class="d-flex">
                                    <MudStack Style="width: 100%">
                                        <MudFileUpload Accept=".pdf, .png"   T="IReadOnlyList<IBrowserFile>" OnFilesChanged="OnInputFileChanged" Hidden="false" 
                                                        Class="flex-1" 
                                                        InputClass="absolute mud-width-full mud-height-full overflow-hidden z-20" 
                                                        InputStyle="opacity:0"
                                                    @ondragenter="@SetDragClass" @ondragleave="@ClearDragClass" @ondragend="@ClearDragClass">
                                            <ButtonTemplate>
                                                <MudPaper Elevation=0  MinHeight=130px Outlined="true" Class="@DragClass">
                                                    <MudText Class="z-30" >Загрузить файл</MudText>
                                                    @foreach (var file in fileNames)
                                                    {   <MudPaper  Elevation=0 Class="d-flex gap-4 mt-4" >
                                                            <MudPaper Elevation=0 MinWidth=70%>
                                                                <MudChip Color="Color.Dark" Text="@file" />
                                                            </MudPaper>
                                                            <MudPaper Elevation=0 MinWidth=20%>
                                                                <MudFab Class="d-flex z-30" OnClick="@Clear" Color="Color.Primary" StartIcon="@Icons.Filled.DeleteOutline"  Size="Size.Small" />
                                                            </MudPaper>
                                                        </MudPaper>  
                                                    }
                                                </MudPaper>
                                            </ButtonTemplate>
                                        </MudFileUpload>
                                        
                                    </MudStack>
                                </MudPaper>
                            </MudPaper>
                            <MudPaper Elevation=0 Width=48% Class="d-flex flex-column">
                                <MudPaper Elevation=0 Class="d-flex">
                                    <MudText>СНИЛС</MudText>
                                </MudPaper>
                                <MudPaper Elevation=0 Class="d-flex">
                                    <MudStack Style="width: 100%">
                                        <MudFileUpload T="IReadOnlyList<IBrowserFile>" OnFilesChanged="OnInputFileChangedSnils" Hidden="false" 
                                                        Class="flex-1" 
                                                        InputClass="absolute mud-width-full mud-height-full overflow-hidden z-20" 
                                                        InputStyle="opacity:0"
                                                    @ondragenter="@SetDragClassSnils" @ondragleave="@ClearDragClassSnils" @ondragend="@ClearDragClassSnils">
                                            <ButtonTemplate>
                                                <MudPaper Elevation=0  MinHeight=130px Outlined="true" Class="@DragClass">
                                                    <MudText Class="z-30" >Загрузить файл</MudText>
                                                    @foreach (var file in fileNamesSnils)
                                                    {   <MudPaper  Elevation=0 Class="d-flex gap-4 mt-4" >
                                                            <MudPaper Elevation=0 MinWidth=70%>
                                                                <MudChip Color="Color.Dark" Text="@file" />
                                                            </MudPaper>
                                                            <MudPaper Elevation=0 MinWidth=20%>
                                                                <MudFab Class="d-flex z-30" OnClick="@ClearSnils" Color="Color.Primary" StartIcon="@Icons.Filled.DeleteOutline"  Size="Size.Small" />
                                                            </MudPaper>
                                                        </MudPaper>  
                                                    }
                                                </MudPaper>
                                            </ButtonTemplate>
                                        </MudFileUpload>
                                        
                                    </MudStack>
                                </MudPaper>
                            </MudPaper>
                            
                        </MudItem>
                    </MudGrid>
                     <MudGrid>
                        <MudItem xs="12" Class="d-flex align-start justify-space-between  gap-4 mt-4" >
                            <MudPaper Elevation=0 Width=48% Class="d-flex flex-column pb-4">
                                <MudPaper Elevation=0 Class="d-flex justify-space-between align-center">
                                    <MudText>Заявление</MudText>
                                    <MudFab Class="d-flex " OnClick="@ClaimPrint" Color="Color.Primary" StartIcon="@Icons.Filled.Print"  Size="Size.Small" />
                                </MudPaper>
                                <MudPaper Elevation=0 Class="d-flex">
                                    <MudStack Style="width: 100%">
                                        <MudFileUpload T="IReadOnlyList<IBrowserFile>" OnFilesChanged="OnInputFileChangedClaim" Hidden="false" 
                                                        Class="flex-1" 
                                                        InputClass="absolute mud-width-full mud-height-full overflow-hidden z-20" 
                                                        InputStyle="opacity:0"
                                                    @ondragenter="@SetDragClassClaim" @ondragleave="@ClearDragClassClaim" @ondragend="@ClearDragClassClaim">
                                            <ButtonTemplate>
                                                <MudPaper Elevation=0  MinHeight=130px Outlined="true" Class="@DragClass">
                                                    <MudText Class="z-30" >Загрузить файл</MudText>
                                                    @foreach (var file in fileNamesClaim)
                                                    {   <MudPaper  Elevation=0 Class="d-flex gap-4 mt-4" >
                                                            <MudPaper Elevation=0 MinWidth=70%>
                                                                <MudChip Color="Color.Dark" Text="@file" />
                                                            </MudPaper>
                                                            <MudPaper Elevation=0 MinWidth=20%>
                                                                <MudFab Class="d-flex z-30" OnClick="@ClearClaim" Color="Color.Primary" StartIcon="@Icons.Filled.DeleteOutline"  Size="Size.Small" />
                                                            </MudPaper>
                                                        </MudPaper>  
                                                    }
                                                </MudPaper>
                                            </ButtonTemplate>
                                        </MudFileUpload>
                                        
                                    </MudStack>
                                </MudPaper>
                            </MudPaper>
                            <MudPaper Elevation=0 Width=48% Class="d-flex flex-column">
                                <MudPaper Elevation=0 Class="d-flex justify-space-between align-center">
                                    <MudText>Доверенность</MudText>
                                    <MudFab Class="d-flex z-30" OnClick="@DoverPrint" Color="Color.Primary" StartIcon="@Icons.Filled.Print"  Size="Size.Small" />
                                </MudPaper>
                                <MudPaper Elevation=0 Class="d-flex">
                                    <MudStack Style="width: 100%">
                                        <MudFileUpload T="IReadOnlyList<IBrowserFile>" OnFilesChanged="OnInputFileChangedDov" Hidden="false" 
                                                        Class="flex-1" 
                                                        InputClass="absolute mud-width-full mud-height-full overflow-hidden z-20" 
                                                        InputStyle="opacity:0"
                                                    @ondragenter="@SetDragClassDov" @ondragleave="@ClearDragClassDov" @ondragend="@ClearDragClassDov">
                                            <ButtonTemplate>
                                                <MudPaper Elevation=0  MinHeight=130px Outlined="true" Class="@DragClass">
                                                    <MudText Class="z-30" >Загрузить файл</MudText>
                                                    @foreach (var file in fileNamesDov)
                                                    {   <MudPaper  Elevation=0 Class="d-flex gap-4 mt-4" >
                                                            <MudPaper Elevation=0 MinWidth=70%>
                                                                <MudChip Color="Color.Dark" Text="@file" />
                                                            </MudPaper>
                                                            <MudPaper Elevation=0 MinWidth=20%>
                                                                <MudFab Class="d-flex z-30" OnClick="@ClearDov" Color="Color.Primary" StartIcon="@Icons.Filled.DeleteOutline"  Size="Size.Small" />
                                                            </MudPaper>
                                                        </MudPaper>  
                                                    }
                                                </MudPaper>
                                            </ButtonTemplate>
                                        </MudFileUpload>
                                        
                                    </MudStack>
                                </MudPaper>
                            </MudPaper>
                            
                        </MudItem>
                    </MudGrid>
                    
                    
                </MudCardContent>
            </MudPaper>
    </MudPaper>
    
</MudGrid>
    



    
    
}

